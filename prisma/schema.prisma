// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model User {
  id                BigInt     @id @unique
  username          String
  displayName       String?
  avatarHash        String?
  currentBookmarkId Int        @default(0)
  messages          Message[]
  bookmarks         Bookmark[]
  tags              Tag[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Message {
  id        BigInt     @id @unique
  author    User       @relation(fields: [authorId], references: [id])
  authorId  BigInt
  data      Json       @db.Json
  bookmarks Bookmark[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Tag {
  id            Int        @id @default(autoincrement())
  name          String
  user          User       @relation(fields: [userId], references: [id])
  userId        BigInt
  autogenerated Boolean
  bookmarks     Bookmark[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, name])
}

model Bookmark {
  id             Int     @id @default(autoincrement())
  user           User    @relation(fields: [userId], references: [id])
  userId         BigInt
  userBookmarkId Int
  message        Message @relation(fields: [messageId], references: [id])
  messageId      BigInt
  tags           Tag[]
  alias          String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, userBookmarkId])
  @@unique([userId, messageId])
}
